// Â© 2022 SolarWinds Worldwide, LLC. All rights reserved.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
//  of this software and associated documentation files (the "Software"), to
//  deal in the Software without restriction, including without limitation the
//  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
//  sell copies of the Software, and to permit persons to whom the Software is
//  furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
//  all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
//  THE SOFTWARE.

import { transformLoessStandardize } from "./transformer-loess-standardize";
import { mockTimeSeriesData } from "./transformer.spec";

describe("TransformerLoessStandardize", () => {
    it("should apply smoothing and standardization to time series data", () => {
        const expectedTransformedDataY = [
            -0.021064762533699044, -0.061752607855071195, -0.09954764412954531,
            -0.13417436306021258, -0.16431933369143947, -0.19005756513628724,
            -0.21001964089932001, -0.22371433561615262, -0.23136588656611123,
            -0.23322281135018996, -0.23055239436338737, -0.22460717278421938,
            -0.20271703089942306, -0.20351993026101112, -0.2215087821370092,
            -0.24613220080040477, -0.27072504399815656, -0.2885652342298657,
            -0.29673501876654185, -0.2966510673415017, -0.2928582281002876,
            -0.29580473860382184, -0.3139515534986843, -0.3507315606822361,
            -0.40313701629760756, -0.46399285383644595, -0.5228000602202358,
            -0.563400473516724, -0.5760059347213813, -0.5621223685576682,
            -0.5320032536238999, -0.501375432895786, -0.48436346232314675,
            -0.4840315291586579, -0.4936249630974474, -0.5064274860616409,
            -0.5211570404482175, -0.5386703225505174, -0.5555987251410828,
            -0.5661160882283569, -0.5706642051064976, -0.5751140387129838,
            -0.5774340166773457, -0.5708739287639604, -0.5497454863344886,
            -0.5121313728869994, -0.4611135234137167, -0.4020036387502317,
            -0.33245003393507644, -0.2496645433840443, -0.15520921682595357,
            -0.051001041150941395, 0.052540182064929164, 0.14925506447785453,
            0.23338556748227135, 0.303394837699541, 0.36401803947397426,
            0.42104939271108166, 0.4773575951565887, 0.5326240140583265,
            0.5761774552682779, 0.5957512806070169, 0.582637213841606,
            0.5396848989638399, 0.48298289154068486, 0.4264325607090156,
            0.3802363964949633, 0.34900357305182994, 0.3308039277197692,
            0.321757593819582, 0.32373906990129186, 0.3291364157574732,
            0.329078039483518, 0.31833738778537524, 0.29804609577864327,
            0.2806999762413922, 0.27366468169371516, 0.2817368166159737,
            0.3037839928746122, 0.33129284010088456, 0.3493591741297293,
            0.3483914590777728, 0.3223624736873332, 0.2791798172273572,
            0.23086813061841682, 0.19193419984536164, 0.1681455187952976,
            0.15882114232395694, 0.1597609003164122, 0.16057170008217114,
            0.15295645996762475, 0.13878532403928845, 0.12333820037311072,
            0.10481062830682064, 0.08885477349563886, 0.07875960716215347,
            0.07510470520524692, 0.0749672895052369, 0.07650671400356956,
            0.08252809995779686, 0.09884950881483534, 0.12203902121278376,
            0.14186834271991544, 0.15049127619009384, 0.14236125270131894,
            0.1281508622795242, 0.11793579577520874, 0.11722628722223605,
            0.13027072564169218, 0.1559137116908984, 0.18312445300567348,
            0.20471584930224496, 0.21734704481228406, 0.21592887387838133,
            0.19590012032300153, 0.1564425016566544, 0.10729739022086293,
            0.05589042029337876, 0.015311615528714961, -0.002371168431766213,
            0.007527758820158548, 0.0343092606070583, 0.06293042931234383,
            0.07514635162247729, 0.06260090106830618, 0.02591012659273262,
            -0.02831084544426843, -0.09099864760186605, -0.15572331742272794,
            -0.2159635398549129, -0.25745334716170176, -0.2724043149629709,
            -0.25766663708613335, -0.2219638787047573, -0.18215980692015576,
            -0.1464578180586089, -0.11364396325201809, -0.0796531689831157,
            -0.03351975472300395, 0.03324740105186508, 0.11962449601729319,
            0.21678548147779808, 0.3163004438846271, 0.4054197448293577,
            0.4714092651719126, 0.501688038837399, 0.49732935561210767,
            0.4669415742845173, 0.4205560960561867, 0.3652713292266141,
            0.30596988350030885, 0.2435500104200925, 0.18492484132171527,
            0.12975136841292412, 0.07678879056935117, 0.02676318628242158,
            -0.008463397234793169, -0.022427966452726045, -0.013249981462779337,
            0.011799209098042107, 0.0377686162699844, 0.04898960208980285,
            0.04292098366282304, 0.0279031639819165, 0.010489609545272893,
            -0.012401076279404455, -0.037394156546854296, -0.05616221677168354,
            -0.06763406166113994, -0.07525412658118724, -0.08864063671912148,
            -0.11219595513661473, -0.14407678421243175, -0.17609625325543887,
            -0.20278152957884443, -0.22197867398985394, -0.22775716039008542,
            -0.2164361458836923, -0.18583281268196727, -0.14401132844626985,
            -0.10000225387752137, -0.061218282395332, -0.03066797223995521,
            -0.005890030892389708, 0.014704938150187141, 0.02999234908371151,
            0.0443466433369919, 0.06336115014151589, 0.09078310178470717,
            0.12172756927780726, 0.15129561824310955, 0.1784033796155724,
            0.19839082236204164, 0.2120210697574818, 0.2157090009621767,
            0.2142599174056683, 0.21140728575288237, 0.21752895582345233,
            0.23758982126478956, 0.2688619757408175, 0.29997510918643244,
            0.32054344438243576, 0.3309402609173573, 0.3321736899925851,
            0.3257410899694675, 0.3104983979300029, 0.28595551631756977,
            0.2578056830551374, 0.22623697649565444, 0.19012046726298437,
            0.15251645072008402, 0.11784003324451775, 0.09338306576124311,
            0.08002445231418975, 0.07077542295324535, 0.06023877862609894,
            0.044020493931254956, 0.025335416868854432, 0.010245569095657325,
            0.0005342284729137337, -0.00891445063202112, -0.02436700835655059,
            -0.05008245167677372, -0.0778966343042542, -0.09795343068084761,
            -0.11010597979306325, -0.11828777742461383, -0.12978850201592862,
            -0.1480670714646679, -0.1647195516399209, -0.19841476344858378,
            -0.23828214623621746, -0.2795797484415219, -0.31958467628114007,
            -0.3568851841393028, -0.39105902142013504, -0.42310966814524575,
            -0.4539208875632015, -0.48482743715989485, -0.5163442725444314,
        ];
        const actualTransformedDataY = transformLoessStandardize(
            mockTimeSeriesData,
            false
        ).map((d) => d.y);
        expect(actualTransformedDataY).toEqual(expectedTransformedDataY);
    });
});
